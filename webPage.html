<!DOCTYPE html>
<html>
<head>
  <link rel="stylesheet" type="text/css" href="webPage.css">
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.5/css/bootstrap.min.css">
  <script src="events.js"></script>
  <script>
  var descripcions={};
  var homepages={};
  function readToDo(){
    //var todo=document.getElementByClass("to-do-box");
    for(i=0; i<toDo.length; i++){
      //adding elements for info on events

      var name=document.createElement("h2");
      name.innerHTML=toDo[i]["name"];
      var location=document.createElement("h4");
      var locImg=document.createElement("img");
      //locImg.setAttribute("src","http://www.clker.com/cliparts/p/R/D/Q/Q/L/map-pin-white-hi.png");
      location.innerHTML=toDo[i]["location"];
      location.appendChild(locImg);

      var date= document.createElement("h3");
      date.innerHTML=toDo[i]["date"];

      var colDiv=document.createElement("div");
      colDiv.setAttribute("class","col-sm-4");

      var link=document.createElement("a");
      link.setAttribute("href","");
      link.setAttribute("href","#");
      link.setAttribute("onclick","popup('popUpDiv', this)");
      //Må jeg sette tom id også?
      var td=document.createElement("div");
      td.setAttribute("class","to-do-box");
      td.setAttribute("id",i);
      td.setAttribute("img-url",toDo[i]["photo"]);
      td.setAttribute("style", "background-image: url("+toDo[i]["photo"]);

      var text=document.createElement("div");
      text.setAttribute("class","text");

      text.appendChild(name);
      text.appendChild(date);
      text.appendChild(location);
      // if(date.length>0){
      //   text.appendChild(location);
      // }

      td.appendChild(text);
      link.appendChild(td);
      colDiv.appendChild(link);
      var insert=document.getElementById("insert");
      insert.appendChild(colDiv);

      //save info for later on object
      //descripcions contains id and descripcion pairs
      desc=toDo[i]["descripcion"];
      descripcions[i]=desc;

      homepage=toDo[i]["homepage"];
      homepages[i]=homepage;
    }
  }

  </script>
</head>
<body>
  <div class="container">
    <div class="row space"></div>
    <div class="row">

      <div class="col-sm-10" name="main page">
        <div class="to-do-boxes">
          <!-- first row for to-do -->
          <div class="row" id="insert">
            <!--Here all the events go, added from js-->
          </div>
          <!-- end to-do boxes -->
        </div>
        <!-- end main page -->
      </div>

      <div id="Blanket" style="display:none"></div>

      <div id="popUpDiv" style="display:none">
        <div id="close">
          <a href="#" onclick="popup('popUpDiv')">x</a>
        </div>

        <div class="pop-up-container" id="to-do-popup">
          <img class="pop-up-photo">
          <h2 class="pp-name"></h2>
          <p class="descripcion"></p>
          <p class="pp-date"></p>
          <p class="pp-location"></p>
          <a class="pp-homepage">Homepage</a><br>
          <input type="submit" value="Done" id="eventDone"></input>
        </div>

      </div>

      <div id="popUpNewEvent" style="display:none">
        <div id="close">
          <a href="#" onclick="popup('popUpNewEvent')">x</a>
        </div>
        <div class="pop-up-new-event-container">
          <h1> Create new To Do: </h1>
          <form>
            <input type="text" id="name" name="name" placeholder="Name of event"><br>
            <input type="text" id="photo" name="photo" placeholder="Url for event photo"><br>
            <input type="text" id="location" name="location" placeholder="Location of event"><br>
            <input type="text" id="date" name="date" placeholder="Date for event"><br>
            <textarea name="descripcion" id="descripcion" placeholder="Event descripcion"></textarea><br>
            <input type="text" name="homepage" id="homepage" placeholder="Url for homepage"><br>
          </form>
          <input type="submit" value="Save new event" id="saveEvent"></input>
        </div>
      </div>


      <div id="sidebar" class="col-sm-2" name="info">

        <div id="addEvent">
          <a href="#" onclick="popup('popUpNewEvent')">
            <img id="addEventPhoto" src="http://cdn.flaticon.com/png/256/52704.png"></img>
          </a>
        </div>

        <nav role="navigation" class="nav">
          <ul class="nav nav-left">
            <li class="sidebar-link active"><a href=""><b>To do</b></a></li>
            <li class="sidebar-link"><a href="#become"><b>Done</b></a></li>
            <li class="sidebar-link"><a href="#what"><b>Do again</b></a></li>
          </ul>
        </nav>
      </div>
    </div>
  </div>
  <script> readToDo();</script>
</body>

<script>


function toggle(div_id) {
  var el = document.getElementById(div_id);
  if ( el.style.display == 'none' ) {
    el.style.display = 'block';
  }
  else {
    el.style.display = 'none';
  }
}
function blanket_size(windowActive) {
  if (typeof window.innerWidth != 'undefined') {
    viewportheight = window.innerHeight;
  } else {
    viewportheight = document.documentElement.clientHeight;
  }
  if ((viewportheight > document.body.parentNode.scrollHeight) && (viewportheight > document.body.parentNode.clientHeight)) {
    blanket_height = viewportheight;
  } else {
    if (document.body.parentNode.clientHeight > document.body.parentNode.scrollHeight) {
      blanket_height = document.body.parentNode.clientHeight;
    } else {
      blanket_height = document.body.parentNode.scrollHeight;
    }
  }
  var blanket = document.getElementById('Blanket');
  blanket.style.height = blanket_height + 'px';
  var windowAct = document.getElementById(windowActive);

  popUpDiv_height=blanket_height/2-200;//200 is half popup's height
  windowAct.style.top = popUpDiv_height + 'px';
}
function window_pos(windowActive) {
  if (typeof window.innerWidth != 'undefined') {
    viewportwidth = window.innerHeight;
  } else {
    viewportwidth = document.documentElement.clientHeight;
  }
  if ((viewportwidth > document.body.parentNode.scrollWidth) && (viewportwidth > document.body.parentNode.clientWidth)) {
    window_width = viewportwidth;
  } else {
    if (document.body.parentNode.clientWidth > document.body.parentNode.scrollWidth) {
      window_width = document.body.parentNode.clientWidth;
    } else {
      window_width = document.body.parentNode.scrollWidth;
    }
  }
  var windowAct = document.getElementById(windowActive);
  window_width=window_width/2-200;//200 is half popup's width
  windowAct.style.left = window_width + 'px';
}

function popup(windowname, element) {
  //console.log(windowname);
  blanket_size(windowname);
  window_pos(windowname);
  toggle('Blanket');
  try{
    makeContent(windowname, element);
  }catch(error){
    console.log("closing");
  }

  toggle(windowname);

  //contentIntPopup(windowname);
}

function makeContent(windowname, element){
  if(windowname === "popUpDiv"){
    console.log(element);
    var srcn=element.getElementsByClassName('to-do-box')[0].getAttribute("img-url");
    var img=document.getElementsByClassName("pop-up-photo")[0];
    img.src=srcn;

    var nameElement=document.getElementsByClassName("pp-name")[0];
    var name=element.children[0].children[0].children[0].innerHTML;
    nameElement.innerHTML=name;

    var descElement=document.getElementsByClassName("descripcion")[0];
    var idNumber=element.children[0].getAttribute("id");
    descElement.innerHTML=descripcions[idNumber];

    var dateElement=document.getElementsByClassName("pp-date")[0];
    var date=element.children[0].children[0].children[1].innerHTML;
    dateElement.innerHTML=date;

    var locationElement=document.getElementsByClassName("pp-location")[0];
    locationElement.innerHTML=element.children[0].children[0].children[2].children[0].innerHTML;

    var homepageElement=document.getElementsByClassName("pp-homepage")[0];
    homepageElement.setAttribute("href",homepages[idNumber]);

  }else{//new event

  }
}

document.getElementById("saveEvent").onclick = function(){
  console.log("in save event");
  var name=document.getElementById("name").value;
  var date=document.getElementById("date").value;
  var location=document.getElementById("location").value;
  var descripcion=document.getElementById("descripcion").value;
  var homepage=document.getElementById('homepage').value;

  if(name.length<1){
    alert("Missing info");
  }else if(date.length<1){
    alert("Missing info");
  }else if(descripcion.length<1){
    alert("Missing info");
  }else{
    console.log(name+", "+date+", "+location+", "+descripcion+", "+homepage);
    //save to toDo:
    eventObj={
      "name": name,
      "photo": photo,
      "location": location,
      "date": date,
      "descripcion": descripcion,
      "homepage": homepage
    };
    toDo.push(eventObj);
    readToDo();
    toggle('Blanket');
    toggle('popUpNewEvent');
  }
}

document.getElementById('eventDone').onclick=function(){

  //Delete from toDo
  //Add to done
}

</script>

</html>
